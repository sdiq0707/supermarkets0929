 <!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> - 进货信息表 - </title>  
    <meta name="keywords" content="">
    <meta name="description" content="">
    <link rel="shortcut icon" href="../favicon.ico"> 
    <link href="../../css/bootstrap.min.css?v=3.3.6" rel="stylesheet">
    <link href="../../css/font-awesome.css?v=4.4.0" rel="stylesheet">
    <link href="../../css/plugins/iCheck/custom.css" rel="stylesheet">
    <link href="../../css/animate.css" rel="stylesheet">
    <link href="../../css/style.css?v=4.1.0" rel="stylesheet">
    <link href="../../layui/css/layui.css" rel="stylesheet" type="text/css" />
    <!-- 全局js -->
    <script src="../../js/jquery.min.js?v=2.1.4"></script>
    <script src="../../js/bootstrap.min.js?v=3.3.6"></script>
	<script src="https://cdn.bootcss.com/vue/2.6.10/vue.js"></script>
	<script src="https://cdn.bootcss.com/vue-resource/1.5.1/vue-resource.min.js"></script>
	<script src="../../layer/layer.js"></script>
    <!-- Peity -->
    <script src="../../js/plugins/peity/jquery.peity.min.js"></script>
    <script src="../../js/demo/peity-demo.js"></script>
    <!-- 自定义js -->
    <script src="../../js/content.js?v=1.0.0"></script>
    <!-- iCheck -->
    <script src="../../js/plugins/iCheck/icheck.min.js"></script>
    <!-- jQuery Validation plugin javascript-->
    <script src="../../js/plugins/validate/jquery.validate.min.js"></script>
    <script src="../../js/plugins/validate/messages_zh.min.js"></script>
    <script src="../../js/demo/form-validate-demo.js"></script>
	<!-- layui -->
	<script src="../../layui/layui.all.js"></script>
	<!-- layerDate plugin javascript -->
    <script src="../../js/plugins/layer/laydate/laydate.js"></script>
</head>
<body class="gray-bg">
    <div id="show" class="wrapper wrapper-content animated fadeInRight">
        <div class="row">
            <div class="col-sm-12">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <h3>进货信息</h3>
                        <div class="ibox-tools">
                            <a class="collapse-link">
                                <i class="fa fa-chevron-up"></i>
                            </a>
                            <a class="dropdown-toggle" data-toggle="dropdown" href="table_basic.html#">
                                <i class="fa fa-wrench"></i>
                            </a>
                            <ul class="dropdown-menu dropdown-user">
                                <li><a href="table_basic.html#">选项1</a>
                                </li>
                                <li><a href="table_basic.html#">选项2</a>
                                </li>
                            </ul>
                            <a class="close-link">
                                <i class="fa fa-times"></i>
                            </a>
                        </div>
                    </div>
                    <div class="btn-group hidden-xs" id="exampleTableEventsToolbar" role="group">
                          <button @click="saveui()" type="button" class="btn btn-outline btn-default">
                               <i class="glyphicon glyphicon-plus" aria-hidden="true"></i>
                          </button>
                          <button type="button" class="btn btn-outline btn-default">
                               <i class="glyphicon glyphicon-heart" aria-hidden="true"></i>
                          </button>
                          <button  type="button" class="btn btn-outline btn-default">
                               <i class="glyphicon glyphicon-trash" aria-hidden="true"></i>
                          </button>
                    </div>
                    <div class="ibox-content">
                        <table class="table table-striped table-hover table-bordered ">
                            <thead >
								<tr>
									<th><input type="checkbox" class="i-checks" name="input[]"></th>
									<th>序号</th>
									<th>进货单编号</th>
									<th>进货日期</th>
									<th>进货总价</th>
									<th>付款方式</th>
									<th>付款情况</th>
									<th>操作员编号</th>
									<th>备注</th>
									<th>操作</th>
								</tr>
							</thead>
							<tbody>
								<tr v-for="(item,i) in list">
									<td>
                                         <input  type="checkbox" class="i-checks" :value="item.piid" name="input[]">
                                    </td>
                                    <td>{{i+1}}</td>
									<td class="text-navy">{{item.piid}}</td>
									<td>{{item.piindate|df}}</td>
									<td class="text-warning">{{item.piallprice}}</td>
									<td>{{item.pipayway}}</td>
									<td>{{item.pipay}}</td>
									<td>{{item.userid}}</td>
									<td>{{item.piothers}}</td>
									<td>
										<a @click="del(item.piid)" type="button" class="btn btn-outline btn-danger">
			                                <i class="glyphicon glyphicon-trash" aria-hidden="true"></i>
			                            </a>
			                            |
										<a @click="updateui(item)" type="button" class="btn btn-outline btn-warning">
			                                <i class="glyphicon glyphicon-pencil" aria-hidden="true"></i>
			                            </a>
									</td>
								</tr>
							</tbody>
							<tfoot>
								<tr>
									<td colspan="12">
										<div id="pagex" style="text-align:center"></div>
									</td>
								</tr>
							</tfoot>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- 添加页面开始 -->
	<div id="add" class="gray-bg" v-show="false">
		<div class="col-sm-12">
			<div class="ibox-title">
				<div class="ibox-tools">
					<a class="collapse-link"> <i class="fa fa-chevron-up"></i>
					</a> 
					<a class="dropdown-toggle" data-toggle="dropdown"
						href="#"> <i class="fa fa-wrench"></i>
					</a>
					<ul class="dropdown-menu dropdown-user">
					</ul>
					<a class="close-link"> <i class="fa fa-times"></i>
					</a>
				</div>
			</div>
			<div class="ibox-content">
				<form class="form-horizontal m-t" id="commentForm">
					<div class="form-group">
						<label class="col-sm-3 control-label">进货日期：</label>
						<div class="col-sm-7">
							<input id="piindate" v-model="productin.piindate" type="date"
							aria-required="true" required="" class="form-control">
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-3 control-label">进货总价：</label>
						<div class="col-sm-7">
							<input id="piallprice" v-model="productin.piallprice" minlength="1" type="text"
								class="form-control" required="" aria-required="true">
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-3 control-label">付款方式：</label>
						<div class="col-sm-7">
							<input id="pipayway" v-model="productin.pipayway" minlength="2" type="text"
								class="form-control" required="" aria-required="true">
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-3 control-label">付款情况：</label>
						<div class="col-sm-7">
							<input id="pipay" v-model="productin.pipay" type="text"
							class="form-control" required="" aria-required="true">
						</div>
					</div>
					
					<div class="form-group">
						<label class="col-sm-3 control-label">操作员编号：</label>
						<div class="col-sm-7">
							<input id="userid" v-model="productin.userid" type="text"
							class="form-control" required="" aria-required="true">
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-3 control-label">备注：</label>
						<div class="col-sm-7">
							<textarea id="piothers" v-model="productin.piothers" type="text"
							class="form-control" required="" aria-required="true"></textarea>
						</div>
					</div>
					
					<div class="form-group">
						<div class="col-sm-4 col-sm-offset-3">
							<button @click="save()" type="button" class="btn btn-primary">提交</button>
						</div>
						<div class="col-sm-4 col-sm-offset-1">
							<button @click="cancel()" type="button" class="btn btn-primary">取消</button>
						</div>
					</div>
				</form>
			</div>
		</div>
	</div>
	<!-- 添加页面结束 -->
	<!-- 修改页面开始 -->
	<div id="update" class="row" v-show="false">
		<div class="col-sm-12">
			<div class="ibox-title">
				<!-- <h4>添加</h4> -->
				<div class="ibox-tools">
					<a class="collapse-link"> <i class="fa fa-chevron-up"></i>
					</a> 
					<a class="dropdown-toggle" data-toggle="dropdown"
						href="#"> <i class="fa fa-wrench"></i>
					</a>
					<ul class="dropdown-menu dropdown-user">
					</ul>
					<a class="close-link"> <i class="fa fa-times"></i>
					</a>
				</div>
			</div>
			<div class="ibox-content">
				<form class="form-horizontal m-t" id="commentForm">
					<div class="form-group">
						<label class="col-sm-3 control-label">进货日期：</label>
						<div class="col-sm-7">
							<input v-model="productin.piid" type="hidden">
							<input id="piindate" v-model="productin.piindate" type="text"
							aria-required="true" required="" class="form-control">
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-3 control-label">进货总价：</label>
						<div class="col-sm-7">
							<input id="piallprice" v-model="productin.piallprice" minlength="1" type="text"
								class="form-control" required="" aria-required="true">
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-3 control-label">付款方式：</label>
						<div class="col-sm-7">
							<input id="pipayway" v-model="productin.pipayway" minlength="2" type="text"
								class="form-control" required="" aria-required="true">
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-3 control-label">付款情况：</label>
						<div class="col-sm-7">
							<input id="pipay" v-model="productin.pipay" type="text"
							class="form-control" required="" aria-required="true">
						</div>
					</div>
					
					<div class="form-group">
						<label class="col-sm-3 control-label">操作员编号：</label>
						<div class="col-sm-7">
							<input id="userid" v-model="productin.userid" type="text"
							class="form-control" required="" aria-required="true">
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-3 control-label">备注：</label>
						<div class="col-sm-7">
							<textarea id="piothers" v-model="productin.piothers" type="text"
							class="form-control" required="" aria-required="true"></textarea>
						</div>
					</div>
					
					<div class="form-group">
						<div class="col-sm-4 col-sm-offset-3">
							<button @click="update()" type="button" class="btn btn-primary">提交</button>
						</div>
						<div class="col-sm-4 col-sm-offset-1">
							<button @click="cancel()" type="button" class="btn btn-primary">取消</button>
						</div>
					</div>
				</form>
			</div>
		</div>
	</div>
	<!-- 修改页面结束 -->
    <script>
	    $(document).ready(function () {
	        $('.i-checks').iCheck({
	            checkboxClass: 'icheckbox_square-green',
	            radioClass: 'iradio_square-green',
	        });
	        
	       
	        layui.laydate.render({
                elem: '#test29'
                ,theme: 'molv'
              });
            show.findAll(pagex,sizex);
         // 调用分页
            toPage();
	    });
	    var pagex = 1;
        var sizex = 5;
        var countx;
        function toPage(){
        	// 分页完整功能   
            layui.laypage.render({
               elem: 'pagex'
               ,count: 30
               ,limit: 5
               ,limits: [5,7,10,15,25,30]
               ,layout: ['count', 'prev', 'page', 'next', 'limit', 'refresh', 'skip']
               ,jump: function(obj){
             	  console.log(obj);
             	  
 				pagex = obj.curr;
 				sizex = obj.limit;
 				show.findAll(obj.curr,obj.limit);
 				
 				console.log(obj.curr + " " + obj.groups+" "+show.countx);
               }
             });
        }
	    
	    
	    Vue.filter("df",function(dateStr){
			var dd=new Date(dateStr);
			var y=dd.getFullYear();
			var m=dd.getMonth()+1;
			var d=dd.getDate();
			return `${y}-${m}-${d}`;
		});
	    var mythis;		//全局变量，每个vue都可以使用--------在这代表el:"#show" vue的this
	   /*  展示Vue-show */
		var show=new Vue({
			el:"#show",
			data:{
				list:"",
				countx:0
			},
			created(){
				this.repalce();
				//this.findAll();
			},
			methods:{
				repalce(){
					mythis=this;
				},
				/* findAll(){
					mythis.$http.get("http://localhost:9999/productIns/findAll").then(function(result){
						mythis.list=result.body;
					});
				}, */
				findAll(currPage,pageSize){
					mythis.$http.post("http://localhost:9999/productIns/findAll",{"currPage":currPage,"pageSize":pageSize},{emulateJSON:true}).then(function(result){
						mythis.list=result.body.list;
						mythis.countx=result.body.count;
					});
				},
				
				del(id){
					/* var _this = this; */
					layer.confirm('您是真删除么？', {
						  icon: 7,
						  btn: ['YES','NO'] //按钮
						}, function(){
							// 在点下yes按钮后发送删除请求给后台，删除数据库中的数据
							 mythis.$http.post("http://localhost:9999/productIns/delete",{"piid":id,"_method":"delete"},{emulateJSON:true}).then(function(){
								 mythis.findAll();
								  layer.msg('删除成功', {icon: 1});
							 });
							
						}, function(){
						  layer.msg('谢谢手下留情', {
						   /*  time: 2000, //2s后自动关闭 */
						    icon: 6
						});
					});
				},
				
				saveui(){
					layer.open({
	                    type: 1,
	                    title: ['添加', 'font-size:18px;'],
	                    skin: 'layui-layer-rim', //加上边框
	                    content: $("#add"),			// 弹出添加div页面
	                    area: ["800px", "600px"],
	                    anim: 4, //动画
	                    closeBtn: 1, //关闭按钮：配置1和2来展示，如果不显示，则closeBtn: 0
	                    shadeClose: true, //点击遮罩关闭
	                    maxmin:true, //最大最小化:该参数值对type:1和type:2有效
	                    resize:true, //是否允许拉伸
	                    success: function(layero, index){//层弹出后的成功回调方法:当需要在层创建完毕时即执行一些语句，可以通过该回调,默认：null
	                    	layer.msg('请填充数据', {icon: 6});//layero, index别是当前层DOM当前层索引
	                 	},
	                    end: function () {
	                    }
	                });
				},
				updateui(item){
					updatex.$data.productin = item;
					// 通过JSON.stringify(Object)方法将对象转化为一个json格式的字符串进行存储
					//	localStorage.setItem("item", JSON.stringify(item));
					layer.open({
	                    type: 1,
	                    title: ['更改', 'font-size:18px;'],
	                    skin: 'layui-layer-rim', //加上边框
	                    content: $("#update"),			// 弹出修改div页面
	                    area: ["800px", "600px"],
	                    anim: 2, //动画
	                    closeBtn: 1, //关闭按钮：配置1和2来展示，如果不显示，则closeBtn: 0
	                    shadeClose: true, //点击遮罩关闭
	                    maxmin:true, //最大最小化:该参数值对type:1和type:2有效
	                    resize:true, //是否允许拉伸
	                    success: function(layero, index){
	                    	layer.msg('请修改数据', {icon: 6});//layero, index别是当前层DOM当前层索引
	                 	},
	                    end: function () {
	                    }
	                });
				}
			}
		});
	   /* 添加的Vue实例 */
		var add=new Vue({
			el:"#add",
			data:{
				productin: {}, 
			},
			created(){
			},
			methods:{
				save(){
					var index=parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
					this.$http.post("http://localhost:9999/productIns/save",this.productin).then(function(){
						layer.msg('保存成功！！！', {
							time: 2000,
							icon: 6
						},function(){
							parent.layer.close(index); //再执行关闭 
							mythis.findAll();		//展示vue中的findAll()方法
						});
					});
				},
				cancel(){
					var index=parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
					layer.msg('谢谢！！！', {
						time: 1500, //1.5s后自动关闭 
						icon: 6
					},function(){
					});
						parent.layer.close(index); //再执行关闭 
				}
			}
		});
	   /* 修改信息的Vue实例 */
	   var updatex=new Vue({
			el:"#update",
			data:{
				productin:{}
			},
			created(){
			},
			methods:{
				update(){
					var json = this.productin;
					var index=parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
					this.$http.put("http://localhost:9999/productIns/update",json,{emulateJSON:true}).then(function(){
						layer.msg('修改成功！！！', {
							time: 2000,
							icon: 6
						},function(){
							parent.layer.close(index); //再执行关闭 
							mythis.findAll();		//展示vue中的findAll()方法
						});
					});
				},
				cancel(){
					var index=parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
					layer.msg('谢谢！！！', {
						time: 1500, //1.5s后自动关闭 
						icon: 6
					},function(){
					});
					parent.layer.close(index); //再执行关闭
				}
			}
		});
	    
    </script>
</body>
</html>
